#!/bin/bash

# Define tools and their installation commands
declare -A tools_commands=(
    [trivy]="brew install trivy" # Replace with your package manager or installation command
    [grype]="brew install grype" # Replace with your package manager or installation command
)

# Define tool repositories and installation commands for cloning
declare -A tools_repos=(
    [dockerfile-linter]="https://github.com/DockerfileLint/dockerfile-linter"
    [falco]="https://github.com/falcosecurity/falco"
    [jok3r]="https://github.com/DonaldWhyte/jok3r"
    [synk]="https://github.com/synk/synk"
    [openscap]="https://github.com/OpenSCAP/openscap"
    [uniscan]="https://github.com/Uniscan/uniscan"
)

# Function to check if a tool is installed
function check_tool {
  command -v "$1" >/dev/null 2>&1
}

# Function to install a tool
install_tool() {
    local tool=$1
    local install_cmd=$2
    echo "Installing $tool..."
    if ! $install_cmd; then
        echo "Failed to install $tool."
    else
        echo "$tool installed successfully."
    fi
}

# Install tools that can be installed
for tool in "${!tools_commands[@]}"; do
    if ! check_tool "$tool"; then
        install_tool "$tool" "${tools_commands[$tool]}"
    else
        echo "$tool is already installed."
    fi
done

# Clone repositories for tools
echo "Cloning repositories for additional tools..."
for tool in "${!tools_repos[@]}"; do
    repo_url="${tools_repos[$tool]}"
    if [ ! -d "$tool" ]; then
        git clone "$repo_url" "$tool"
        echo "Cloned $tool from $repo_url."
    else
        echo "$tool repository already exists."
    fi
done

# List all tools with instructions
echo "Listing all tools and how to use them:"

echo "1. **trivy**"
echo "   - **Installation**: ${tools_commands[trivy]}"
echo "   - **Usage**: trivy fs <path-to-image-or-container>"

echo "2. **grype**"
echo "   - **Installation**: ${tools_commands[grype]}"
echo "   - **Usage**: grype <path-to-image-or-container>"

for tool in "${!tools_repos[@]}"; do
    case "$tool" in
        dockerfile-linter)
            echo "3. **dockerfile-linter**"
            echo "   - **Repository**: ${tools_repos[$tool]}"
            echo "   - **Usage**: dockerfile-linter <path-to-Dockerfile>"
            ;;
        falco)
            echo "4. **falco**"
            echo "   - **Repository**: ${tools_repos[$tool]}"
            echo "   - **Usage**: falco -c <path-to-config-file>"
            ;;
        jok3r)
            echo "5. **jok3r**"
            echo "   - **Repository**: ${tools_repos[$tool]}"
            echo "   - **Usage**: jok3r -u <url-to-test>"
            ;;
        synk)
            echo "6. **synk**"
            echo "   - **Repository**: ${tools_repos[$tool]}"
            echo "   - **Usage**: synk <scan-options>"
            ;;
        openscap)
            echo "7. **openscap**"
            echo "   - **Repository**: ${tools_repos[$tool]}"
            echo "   - **Usage**: oscap <scan-options>"
            ;;
        uniscan)
            echo "8. **uniscan**"
            echo "   - **Repository**: ${tools_repos[$tool]}"
            echo "   - **Usage**: uniscan -u <url-to-scan>"
            ;;
        *)
            echo "Unknown tool: $tool"
            ;;
    esac
done
