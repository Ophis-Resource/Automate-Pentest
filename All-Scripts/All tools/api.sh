#!/bin/bash


# List of tools and their installation methods
declare -A tools
tools=(
    ["arjun"]="pip install arjun"
    ["golismero"]="git clone https://github.com/golismero/golismero.git && cd golismero && pip install -r requirements.txt"
    ["uniscan"]="git clone https://github.com/ardamavi/uniscan.git && cd uniscan && chmod +x uniscan && sudo cp uniscan /usr/local/bin/"
    ["apiclarity"]="echo 'Manual installation required: Visit https://apiclarity.org/ for instructions.'"
    ["astra"]="echo 'Manual installation required: Visit https://www.astrea.io/ for instructions.'"
    ["vulnapi"]="echo 'Manual installation required: Visit https://github.com/fortra/vulnapi for instructions.'"
    ["openapi fuzzer"]="echo 'Manual installation required: Visit https://github.com/OAI/OpenAPI-Specification for instructions.'"
    ["graphinder"]="pip install graphinder"
    ["kiterunner"]="echo 'Manual installation required: Visit https://github.com/portcullislabs/kiterunner for instructions.'"
    ["devtools"]="pip install devtools"
    ["cdk"]="npm install -g aws-cdk"
    ["secret scanner"]="pip install git+https://github.com/airbnb/semgrep"
    ["threat mapper"]="echo 'Manual installation required: Visit https://github.com/ThreatMapper/threatmapper for instructions.'"
    ["amicontained"]="echo 'Manual installation required: Visit https://github.com/amicontained/amicontained for instructions.'"
    ["syft"]="curl -sSfL https://raw.githubusercontent.com/anchore/syft/main/install.sh | sh"
    ["botb"]="echo 'Manual installation required: Visit https://github.com/botb for instructions.'"
    ["clair"]="docker pull quay.io/coreos/clair"
    ["clair-scanner"]="docker pull arminc/clair-scanner"
    ["dagda"]="echo 'Manual installation required: Visit https://github.com/VMware/dagda for instructions.'"
    ["dockscan"]="echo 'Manual installation required: Visit https://github.com/bozhu/dockscan for instructions.'"
    ["ggshield"]="pip install ggshield"
    ["harpoon"]="pip install harpoon"
    ["iwtools"]="echo 'Manual installation required: Visit https://github.com/iwtools/iwtools for instructions.'"
    ["runc"]="echo 'Manual installation required: Visit https://github.com/opencontainers/runc for instructions.'"
)

# Function to check and install tools
check_and_install() {
    local tool=$1
    local install_command=$2
    
    # Check if the tool is installed
    if ! command -v "$tool" &> /dev/null; then
        echo "$tool is not installed."
        if [[ "$install_command" == *"Manual installation required:"* ]]; then
            echo "$install_command"
        else
            read -p "Do you want to install $tool? (y/n): " choice
            if [[ "$choice" == "y" || "$choice" == "Y" ]]; then
                echo "Installing $tool..."
                eval "$install_command"
                echo "$tool installed successfully."
            else
                echo "$tool installation skipped."
            fi
        fi
    else
        echo "$tool is already installed."
    fi
}

# Install tools
echo "Starting tool installation..."
for tool in "${!tools[@]}"; do
    install_command="${tools[$tool]}"
    check_and_install "$tool" "$install_command"
done

echo "Tool installation process completed."

# Prompt for additional actions if needed
echo ""
read -p "Do you need to perform any additional setup or scans? (y/n): " additional_actions

if [[ "$additional_actions" == "y" || "$additional_actions" == "Y" ]]; then
    echo "Please perform any additional setup or scans as required."
else
    echo "No additional actions needed."
fi
